name: Auto Close Milestone

on:
  issues:
    types: [closed]

jobs:
  close-milestone:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const milestone = context.payload.issue.milestone;
            if (!milestone) return;

            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              milestone: milestone.number,
              state: 'open'
            });

            if (issues.length === 0) {
              await github.rest.issues.updateMilestone({
                owner: context.repo.owner,
                repo: context.repo.repo,
                milestone_number: milestone.number,
                state: 'closed'
              });
              console.log(`Milestone "${milestone.title}" closed`);
            }
